<?xml version="1.0" encoding="UTF-8"?>

<?import com.jfoenix.controls.*?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.chart.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import de.jensd.fx.glyphs.materialdesignicons.MaterialDesignIconView?>

<StackPane xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1"
         fx:controller="com.groupeisi.minisystemebancaire.controllers.client.CreditCarteController"
         styleClass="root">

    <!-- Loading Spinner -->
    <JFXSpinner fx:id="loadingSpinner" styleClass="spinner" visible="false"/>

    <!-- Main Content -->
    <ScrollPane fitToWidth="true" styleClass="content-scroll">
        <VBox spacing="20" styleClass="credit-container">
            <padding>
                <Insets top="20" right="20" bottom="20" left="20"/>
            </padding>

            <!-- Crédit actif -->
            <VBox fx:id="creditActifContainer" spacing="15" styleClass="credit-card" visible="false">
                <HBox alignment="CENTER_LEFT" spacing="10">
                    <MaterialDesignIconView glyphName="CREDIT_CARD_SETTINGS" size="24"/>
                    <Label text="Crédit en cours" styleClass="section-title"/>
                </HBox>

                <GridPane hgap="20" vgap="10">
                    <Label text="Statut :" GridPane.columnIndex="0" GridPane.rowIndex="0"/>
                    <Label fx:id="creditStatutLabel" styleClass="credit-status"
                           GridPane.columnIndex="1" GridPane.rowIndex="0"/>

                    <JFXButton fx:id="exportButton" text="Exporter l'échéancier"
                              onAction="#exporterEcheancier"
                              buttonType="RAISED"
                              styleClass="button-secondary"
                              GridPane.columnIndex="2" GridPane.rowIndex="0">
                        <graphic>
                            <MaterialDesignIconView glyphName="EXPORT" size="18"/>
                        </graphic>
                    </JFXButton>
                </GridPane>

                <JFXListView fx:id="echeancierList" styleClass="echeancier-list"/>
            </VBox>

            <!-- Simulation de crédit -->
            <VBox spacing="15" styleClass="simulation-container">
                <Label text="Simuler un crédit" styleClass="section-title"/>

                <GridPane hgap="20" vgap="15">
                    <columnConstraints>
                        <ColumnConstraints percentWidth="33"/>
                        <ColumnConstraints percentWidth="33"/>
                        <ColumnConstraints percentWidth="33"/>
                    </columnConstraints>

                    <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="0">
                        <Label text="Montant (€)" styleClass="field-label"/>
                        <JFXTextField fx:id="montantField" styleClass="input-field"
                                    promptText="Ex: 10000"/>
                    </VBox>

                    <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                        <Label text="Taux annuel (%)" styleClass="field-label"/>
                        <JFXTextField fx:id="tauxField" styleClass="input-field"
                                    promptText="Ex: 3.5"/>
                    </VBox>

                    <VBox spacing="5" GridPane.columnIndex="2" GridPane.rowIndex="0">
                        <Label text="Durée (années)" styleClass="field-label"/>
                        <JFXTextField fx:id="dureeField" styleClass="input-field"
                                    promptText="Ex: 5"/>
                    </VBox>
                </GridPane>

                <!-- Résultats de la simulation -->
                <GridPane hgap="20" vgap="10" styleClass="results-container">
                    <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="0">
                        <Label text="Mensualité" styleClass="result-label"/>
                        <Label fx:id="mensualiteLabel" styleClass="result-value"/>
                    </VBox>

                    <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                        <Label text="Total intérêts" styleClass="result-label"/>
                        <Label fx:id="totalInteretsLabel" styleClass="result-value"/>
                    </VBox>

                    <VBox spacing="5" GridPane.columnIndex="2" GridPane.rowIndex="0">
                        <Label text="Coût total" styleClass="result-label"/>
                        <Label fx:id="coutTotalLabel" styleClass="result-value"/>
                    </VBox>
                </GridPane>

                <!-- Graphique d'amortissement -->
                <LineChart fx:id="amortissementChart"
                          title="Tableau d'amortissement"
                          legendVisible="true"
                          styleClass="amortissement-chart">
                    <xAxis>
                        <NumberAxis label="Années"/>
                    </xAxis>
                    <yAxis>
                        <NumberAxis label="Montant (€)"/>
                    </yAxis>
                </LineChart>

                <HBox alignment="CENTER">
                    <JFXButton fx:id="demanderButton"
                              text="Demander ce crédit"
                              buttonType="RAISED"
                              onAction="#demanderCredit"
                              styleClass="button-primary">
                        <graphic>
                            <MaterialDesignIconView glyphName="CHECK_CIRCLE" size="18"/>
                        </graphic>
                    </JFXButton>
                </HBox>
            </VBox>
        </VBox>
    </ScrollPane>
</StackPane>
