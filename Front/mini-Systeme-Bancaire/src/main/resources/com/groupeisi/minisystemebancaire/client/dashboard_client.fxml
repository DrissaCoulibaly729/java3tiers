<?xml version="1.0" encoding="UTF-8"?>

<?import com.jfoenix.controls.*?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.chart.PieChart?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Font?>
<?import de.jensd.fx.glyphs.materialdesignicons.*?>

<?import java.net.URL?>
<StackPane xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1"
           fx:controller="com.groupeisi.minisystemebancaire.controllers.client.DashboardClientController"
           styleClass="root">

    <!-- Loading Overlay -->
    <StackPane fx:id="loadingOverlay" visible="false" style="-fx-background-color: rgba(0, 0, 0, 0.5);">
        <JFXSpinner styleClass="spinner"/>
    </StackPane>

    <!-- Main Content -->
    <BorderPane styleClass="dashboard-container" maxWidth="Infinity" maxHeight="Infinity">
        <top>
            <!-- Header -->
            <HBox alignment="CENTER_LEFT" spacing="20" styleClass="header-box">
                <padding><Insets top="20" right="20" bottom="20" left="20"/></padding>
                <Label fx:id="welcomeLabel" styleClass="welcome-label">
                    <font><Font name="System Bold" size="24"/></font>
                </Label>
            </HBox>
        </top>

        <center>
            <VBox spacing="20" BorderPane.alignment="CENTER">
                <!-- Stats Cards -->
                <GridPane hgap="20" vgap="20" alignment="CENTER">
                    <columnConstraints>
                        <ColumnConstraints hgrow="ALWAYS" fillWidth="true" percentWidth="50"/>
                        <ColumnConstraints hgrow="ALWAYS" fillWidth="true" percentWidth="50"/>
                    </columnConstraints>

                    <!-- Solde Card -->
                    <VBox styleClass="dashboard-card" GridPane.columnIndex="0" GridPane.rowIndex="0">
                        <MaterialDesignIconView glyphName="BANK" size="30"/>
                        <Label text="Solde Total" styleClass="card-title"/>
                        <Label fx:id="soldeLabel" styleClass="card-value"/>
                    </VBox>

                    <!-- Transactions Card -->
                    <VBox styleClass="dashboard-card" GridPane.columnIndex="1" GridPane.rowIndex="0">
                        <MaterialDesignIconView glyphName="SWAP_HORIZONTAL" size="30"/>
                        <Label text="Transactions" styleClass="card-title"/>
                        <Label fx:id="nombreTransactionsLabel" styleClass="card-value"/>
                    </VBox>
                </GridPane>

                <!-- Main Content Area -->
                <SplitPane dividerPositions="0.5" orientation="HORIZONTAL" VBox.vgrow="ALWAYS">
                    <!-- Left Side - Accounts Table -->
                    <VBox spacing="10" styleClass="content-section">
                        <Label text="Mes Comptes" styleClass="section-title"/>
                        <TableView fx:id="comptesTable" VBox.vgrow="ALWAYS" styleClass="accounts-table">
                            <columns>
                                <TableColumn fx:id="accountNumberCol" text="Numéro de compte" prefWidth="150"/>
                                <TableColumn fx:id="accountTypeCol" text="Type" prefWidth="100"/>
                                <TableColumn fx:id="accountBalanceCol" text="Solde" prefWidth="120"/>
                            </columns>
                            <columnResizePolicy>
                                <TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/>
                            </columnResizePolicy>
                        </TableView>
                    </VBox>

                    <!-- Right Side - Chart and Transactions -->
                    <SplitPane dividerPositions="0.6" orientation="VERTICAL">
                        <!-- Chart -->
                        <VBox spacing="10" styleClass="content-section">
                            <Label text="Dépenses par catégorie" styleClass="section-title"/>
                            <PieChart fx:id="depensesChart" VBox.vgrow="ALWAYS" styleClass="chart-container"/>
                        </VBox>

                        <!-- Recent Transactions -->
                        <VBox spacing="10" styleClass="content-section">
                            <Label text="Dernières Transactions" styleClass="section-title"/>
                            <TableView fx:id="dernieresTransactionsTable" VBox.vgrow="ALWAYS">
                                <columns>
                                    <TableColumn text="Date" prefWidth="120"/>
                                    <TableColumn text="Montant" prefWidth="100"/>
                                    <TableColumn text="Description" prefWidth="200"/>
                                </columns>
                                <columnResizePolicy>
                                    <TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/>
                                </columnResizePolicy>
                            </TableView>
                        </VBox>
                    </SplitPane>
                </SplitPane>
            </VBox>
        </center>

        <bottom>
            <!-- Action Buttons -->
            <HBox spacing="10" alignment="CENTER" styleClass="footer-box">
                <padding><Insets top="10" right="20" bottom="20" left="20"/></padding>
                <JFXButton fx:id="virementsBtn" text="Virements" styleClass="action-button" onAction="#ouvrirVirements">
                    <graphic><MaterialDesignIconView glyphName="BANK_TRANSFER" size="24"/></graphic>
                </JFXButton>
                <JFXButton fx:id="cartesBtn" text="Cartes" styleClass="action-button" onAction="#ouvrirCartesBancaires">
                    <graphic><MaterialDesignIconView glyphName="CREDIT_CARD" size="24"/></graphic>
                </JFXButton>
                <JFXButton fx:id="creditsBtn" text="Crédits" styleClass="action-button" onAction="#ouvrirCredits">
                    <graphic><MaterialDesignIconView glyphName="CARDS" size="24"/></graphic>
                </JFXButton>
                <JFXButton fx:id="supportBtn" text="Support" styleClass="action-button" onAction="#ouvrirSupport">
                    <graphic><MaterialDesignIconView glyphName="HELP_CIRCLE" size="24"/></graphic>
                </JFXButton>
            </HBox>
        </bottom>
    </BorderPane>

    <stylesheets>
        <URL value="@../styles/dashboard.css" />
    </stylesheets>
</StackPane>
